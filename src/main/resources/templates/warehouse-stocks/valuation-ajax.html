<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
<title th:text="#{label.warehouse.stock.summary}"></title>
<th:block th:insert="~{fragments/header :: head}"></th:block>
</head>
<body>
	<th:block th:insert="~{fragments/header :: pre-loader}"></th:block>
	<div id="pcoded" class="pcoded">
		<div class="pcoded-overlay-box"></div>
		<div class="pcoded-container navbar-wrapper">

			<th:block th:insert="~{fragments/header :: navbar-top}"></th:block>

			<div class="pcoded-main-container">
				<div class="pcoded-wrapper">
					<th:block th:insert="~{fragments/header :: navbar-left}"></th:block>

					<div class="pcoded-content">
						<div class="pcoded-inner-content">
							<!-- Main-body start -->
							<div class="main-body">
								<div class="page-wrapper">
									<!-- Page-body start -->
									<div class="page-body">

										<!-- Hover table card start -->
										<div class="card">

											<div class="card-header py-2">
												<div
													class="d-flex justify-content-between align-items-center flex-wrap">
													<h5 th:text="#{label.warehouse.stock.summary}"></h5>
													<div class="d-flex flex-wrap align-items-center gap-2">
														<!-- Search Form -->

														<div class="d-flex flex-wrap align-items-center gap-2">
															<div class="input-group input-group-sm">
																<div class="input-group-append">
																	<!-- Excel Button -->
																	<a th:href="@{/warehouse-stocks/valuation/excel}"
																		class="btn btn-success btn-sm waves-effect waves-light d-inline-flex align-items-center justify-content-center"
																		style="height: 32px; width: 32px; padding: 0; margin-left: 2px;"
																		th:title="#{label.button.export.excel}"> <i
																		class="fa fa-file-excel-o"></i>
																	</a>
																	<!-- Pdf Button -->
																	<a th:href="@{/warehouse-stocks/valuation/pdf}"
																		class="btn btn-danger btn-sm waves-effect waves-light d-inline-flex align-items-center justify-content-center"
																		style="height: 32px; width: 32px; padding: 0; margin-left: 2px;"
																		th:title="#{label.button.export.pdf}"> <i
																		class="fa fa-file-pdf-o"></i>
																	</a>
																</div>
															</div>
														</div>

													</div>
												</div>
											</div>
											<div class="dt-responsive table-responsive">
												<table id="stock-evaluation-table"
													class="table table-striped table-bordered nowrap"
													style="width: 100%">
													<thead>
														<tr>
															<th>#</th>
															<th th:text="#{label.general.code}">Code</th>
															<th th:text="#{label.general.name}">Name</th>
															<th th:text="#{label.general.quantity.total}">Stock</th>
															<th th:text="#{label.button.actions}">Actions</th>
														</tr>
													</thead>
													<tbody></tbody>
													<!-- Empty! DataTables fills it via AJAX -->
												</table>
											</div>
										</div>

									</div>
									<!-- Hover table card end -->

								</div>

								<!-- Page-body end -->
							</div>
							<div id="styleSelector"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<th:block th:insert="~{fragments/header :: footer}"></th:block>
	<!-- DataTables CDN (fastest in 2025) -->
<link href="https://cdn.datatables.net/v/dt/dt-2.1.6/b-3.1.2/b-colvis-3.1.2/datatables.min.css" rel="stylesheet">
<script src="https://cdn.datatables.net/v/dt/dt-2.1.6/b-3.1.2/b-colvis-3.1.2/datatables.min.js"></script>

<script th:inline="javascript">
    $(document).ready(function() {
        $('#stock-evaluation-table').DataTable({
            processing: true,
            serverSide: true,
            ajax: {
                url:  /*[[@{/warehouse-stocks/evaluation/data}]]*/,  // ‚Üê Your new REST endpoint
                type: 'POST',
                contentType: 'application/json',
                data: function(d) {
                    return JSON.stringify(d);  // DataTables.net expects JSON
                }
            },
            pageLength: 50,
            lengthMenu: [25, 50, 100, 500],
            columns: [
                { 
                    data: null,               // no data needed
                    orderable: false,
                    render: function (data, type, row, meta) {
                        return meta.row + 1 + meta.settings._iDisplayStart;  // auto row number
                    }
                },
                { data: 'productCode' },
                { data: 'productName' },
                {
                    data: 'totalQuantity',
                    render: function(data) {
                        if (data == null) return '<span class="badge bg-secondary">N/A</span>';
                        if (data > 0)     return '<span class="badge bg-success">' + data + '</span>';
                        if (data == 0)    return '<span class="badge bg-warning text-dark">0</span>';
                        return '<span class="badge bg-danger">' + data + '</span>';
                    }
                },
                {
                    data: 'itemId',
                    orderable: false,
                    render: function(data) {
                        return `<a href="/warehouse-stocks/warehouse/product/${data}" class="btn btn-sm btn-primary">
                                   <i class="fa fa-eye"></i>
                                </a>`;
                    }
                }
            ],
            language: {
                processing: "Loading...",
                emptyTable: "No products found"
            }
        });
    });
</script>
</body>

</html>
