<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
<title th:text="#{label.item.list}"></title>
<th:block th:insert="~{fragments/header :: head}"></th:block>
</head>
<body>
	<th:block th:insert="~{fragments/header :: pre-loader}"></th:block>
	<div id="pcoded" class="pcoded">
		<div class="pcoded-overlay-box"></div>
		<div class="pcoded-container navbar-wrapper">

			<th:block th:insert="~{fragments/header :: navbar-top}"></th:block>

			<div class="pcoded-main-container">
				<div class="pcoded-wrapper">
					<th:block th:insert="~{fragments/header :: navbar-left}"></th:block>

					<div class="pcoded-content">
						<div class="pcoded-inner-content">
							<!-- Main-body start -->
							<div class="main-body">
								<div class="page-wrapper">
									<!-- Page-body start -->
									<div class="page-body">

										<!-- Hover table card start -->
										<div class="card">
											<div class="card-header py-2">
												<div
													class="d-flex justify-content-between align-items-center flex-wrap">
													<h5 class="mb-0" th:text="#{label.item.list}"></h5>

													<div class="d-flex flex-wrap align-items-center gap-2">
														<!-- Search Form -->
														<form th:action="@{/items/filter}" method="get"
															class="form-inline align-items-center mr-2">
															<div class="input-group input-group-sm">
																<input type="text" name="searchTerm"
																	th:value="${searchTerm}"
																	class="form-control form-control-sm"
																	placeholder="Search by name, code, or barcode"
																	style="width: 280px !important; min-width: 200px; max-width: 400px; flex: none !important;" />


																<div class="input-group-append">
																	<!-- Search Button -->
																	<button type="submit"
																		class="btn btn-primary btn-sm waves-effect waves-light d-inline-flex align-items-center justify-content-center"
																		style="height: 32px; width: 32px; padding: 0;"
																		th:title="#{label.button.search}">
																		<i class="fa fa-search"></i>
																	</button>

																	<!-- Reset Button -->
																	<a th:href="@{/items/list}"
																		class="btn btn-secondary btn-sm waves-effect waves-light d-inline-flex align-items-center justify-content-center"
																		style="height: 32px; width: 32px; padding: 0; margin-left: 2px;"
																		th:title="#{label.button.reset}"> <i
																		class="fa fa-times"></i>
																	</a>
																	<!-- Import Button -->
																	<button type="button"
																		class="btn btn-warning btn-sm waves-effect waves-light md-trigger ml-1 d-inline-flex align-items-center justify-content-center"
																		style="height: 32px; width: 32px; padding: 0;"
																		data-toggle="modal" data-target="#importItemModal"
																		th:title="#{label.button.import}">
																		<i class="fa fa-upload"></i>
																	</button>

																	<!-- New Button -->
																	<a th:href="@{/items/new}"
																		class="btn btn-primary btn-sm waves-effect waves-light ml-1 d-inline-flex align-items-center justify-content-center"
																		style="height: 32px; width: 32px; padding: 0;"
																		th:title="#{label.button.new}"> <i
																		class="fa fa-plus"></i>
																	</a>

																</div>

															</div>
														</form>
													</div>
												</div>
											</div>
											<div class="dt-responsive table-responsive">
												<table id="code-type-table"
													class="table table-striped table-bordered compact nowrap"
													th:if="${lists != null}">
													<caption></caption>
													<thead>
														<tr>
															<th>#</th>
															<th scope="col" th:text="#{label.general.name}"></th>
															<th scope="col" th:text="#{label.general.barcode}"></th>
															<th scope="col" th:text="#{label.general.code}"></th>
															<th scope="col" th:text="#{label.general.sale.price}"></th>
															<th scope="col" th:text="#{label.general.purchase.price}"></th>
															<th scope="col" th:text="#{label.button.actions}"></th>
														</tr>
													</thead>
													<tbody>
														<tr th:each="list,stat : ${lists}">
															<th scope="row" th:text="${stat.index + 1}"></th>
															<td th:text="${list.itemName}"></td>
															<td th:text="${list.barcode}"></td>
															<td th:text="${list.itemCode}"></td>
															<!-- unitPrice clickable -->
															<td><a href="#" data-toggle="modal"
																data-target="#updatePriceModal" th:data-id="${list.id}"
																th:data-type="'price'" th:data-value="${list.unitPrice}"
																class="text-primary open-update-modal"> <span
																	th:text="${list.unitPrice}"></span>
															</a></td>

															<!-- unitCost clickable -->
															<td><a href="#" data-toggle="modal"
																data-target="#updatePriceModal" th:data-id="${list.id}"
																th:data-type="'cost'" th:data-value="${list.unitCost}"
																class="text-success open-update-modal"> <span
																	th:text="${list.unitCost}"></span>
															</a></td>
															<td><a href="#"
																th:href="@{'/items/update/' + ${list.id}}"
																class="btn waves-effect waves-light btn-success"><span
																	class="pcoded-micon"><em
																		class="icofont icofont-edit"></em></span></a> <a href="#"
																th:href="@{'/items/view/' + ${list.id}}"
																class="btn waves-effect waves-light btn-primary"><span
																	class="pcoded-micon"><em
																		class="icofont icofont-eye"></em></span></a></td>
														</tr>

													</tbody>
												</table>
											</div>
										</div>

									</div>
									<!-- Hover table card end -->

								</div>

								<!-- Page-body end -->
							</div>
							<div id="styleSelector"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<th:block th:insert="~{fragments/header :: footer}"></th:block>
	<div class="modal fade" id="updatePriceModal" tabindex="-1"
		role="dialog">
		<div class="modal-dialog modal-sm" role="document">
			<div class="modal-content">
				<form th:action="@{/items/updatePrice}" method="post">
					<div class="modal-header">
						<h5 class="modal-title">Update Value</h5>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>

					<div class="modal-body">
						<input type="hidden" id="itemId" name="id"> <input
							type="hidden" id="updateType" name="type">
						<div class="form-group">
							<label for="newValue">New Value</label> <input type="number"
								step="0.01" id="newValue" name="value" class="form-control"
								required>
						</div>
					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Save</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<div class="modal fade" id="importItemModal" tabindex="-1"
		role="dialog">
		<div class="modal-dialog modal-sm" role="document">
			<div class="modal-content">
				<form th:action="@{/items/upload}" method="post"
					enctype="multipart/form-data">
					<div class="modal-header">
						<h4 class="modal-title">Import Items Form</h4>
					</div>
					<div class="modal-body">

						<div class="mb-3">
							<label for="warehouseSelect" class="form-label">File</label> <input
								type="file" id="file" name="file"
								class="form-control form-control-bold" required accept=".xlsx" />
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Import</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script>
document.addEventListener("DOMContentLoaded", function () {
    const links = document.querySelectorAll(".open-update-modal");
    const modal = document.getElementById("updatePriceModal");
    const itemIdInput = modal.querySelector("#itemId");
    const typeInput = modal.querySelector("#updateType");
    const valueInput = modal.querySelector("#newValue");

    links.forEach(link => {
        link.addEventListener("click", () => {
            const id = link.getAttribute("data-id");
            const type = link.getAttribute("data-type");
            const value = link.getAttribute("data-value");

            itemIdInput.value = id;
            typeInput.value = type;
            valueInput.value = value;
        });
    });
});
</script>

</body>

</html>
